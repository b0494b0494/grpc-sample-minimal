# ??OCR?????? ??????

## ???????2025-11-01?

### 1. EasyOCR??????? ?

**??:**
- EasyOCR????????????PyTorch????????
- Alpine Linux?PyTorch???????????
- ???????????????`libleptonica.so.6: cannot open shared object file`?

**???:**
- ???????: Alpine ? Debian????`golang:1.25`????
- Runtime????: Alpine ? Debian????`python:3.11-slim`????
- Tesseract??????????????`libtesseract5`, `libleptonica6`?
- `LD_LIBRARY_PATH`???????????????????

**??????:**
- `Dockerfile.easyocr`

**??:**
- ? EasyOCR??????????
- ? EasyOCR?????????????50053??????
- ? EasyOCR????????????

---

### 2. ?????????????????? ?

**????:**
- `Dockerfile.tesseract`: Tesseract??????
- `Dockerfile.easyocr`: EasyOCR??????
- `docker-compose.yml`: ??OCR???????
  - `ocr-tesseract-service`: ???50052
  - `ocr-easyocr-service`: ???50053

**????:**
- Docker??????????????????????
- ???????????????
- ?????????????
- ???????????CPU?

**????:**
- ? Tesseract????: ???????
- ? EasyOCR????: ???????

---

### 3. MultiOCRClient?????? ?

**??????:**
- `server/domain/multi_ocr_client.go` (????)

**??:**
- ??OCR??????????
- ????????????:
  - `OCR_TESSERACT_ENDPOINT`
  - `OCR_EASYOCR_ENDPOINT`
  - `OCR_PADDLEOCR_ENDPOINT` (????)
- ???????????`sync.RWMutex`?
- `ProcessDocument`: ???????????????????
- `GetClient`: ???????????????
- `GetAvailableEngines`: ???????????

---

### 4. server/main.go??MultiOCRClient??? ?

**????:**
- `MultiOCRClient`??????????????????
- ????????:
  - ????????????: `MultiOCRClient`???
  - ????????????: ???`OCRClient`???
- ???????????????????

**??????:**
- `server/main.go`

**????:**
- ? ?????
- ? ????????

---

## ??????????

```
???????????????
?   WebApp    ? (???8080)
?  (Upload)   ?
???????????????
       ?
       ?
???????????????
?   Server    ? (???50051)
? Application ?
?   Service   ?
???????????????
       ?
       ???? QueueManager ??? Azure Queue / SQS / Pub/Sub
       ?
       ???? MultiOCRClient
              ???? OCR_TESSERACT_ENDPOINT ??? ocr-tesseract-service:50052
              ???? OCR_EASYOCR_ENDPOINT   ??? ocr-easyocr-service:50053
```

### OCR?????

1. **??????????**
   - WebApp ? Server (gRPC)
   - Server ? Storage (Azure/S3/GCS)

2. **OCR????????**
   - Server ? QueueManager ? Azure Queue

3. **OCR??????**
   - ocr-tesseract-service: ?????????? ? Tesseract???
   - ocr-easyocr-service: ?????????? ? EasyOCR???

4. **????**
   - ????? ? SQLite DB (`ocr_results`????)

5. **????**
   - Client ? Server ? ocrResultRepo (DB????)

---

## ??????

### ??????2025-11-01?

**?????:**
- ??????????: `test-ocr-1762008538.png`
- ?????: Azure Blob Storage

**??:**
- ? ??????????: ??
- ? OCR????????: ??
- ? Tesseract????: ???????????
- ? EasyOCR????: ???????????

**????:**
```
server-1  | OCR task queued via QueueManager for file: test-ocr-1762008538.png (provider: azure)
ocr-tesseract-service-1  | Processing OCR with engines: [tesseract]
ocr-easyocr-service-1  | Processing OCR with engines: [easyocr]
```

---

## ???????TODO?

### ???: ?

1. **ApplicationService?MultiOCRClient?????**
   - ?????????????????????????
   - `ApplicationService`?`MultiOCRClient`???????????????
   - ???????????????????

2. **OCR?????????????**
   - `CompareOCRResults`?????????
   - ???????????UI

3. **????????????**
   - ????????????????
   - ????????

### ???: ?

4. **???OCR???????**
   - PaddleOCR????`Dockerfile.paddleocr`?
   - `OCR_PADDLEOCR_ENDPOINT`??

5. **??????????**
   - ????????
   - ???????

6. **????????**
   - OCR???????
   - ????????????

### ???: ?

7. **UI???**
   - ?????????????
   - ???????

8. **??????**
   - API??????
   - ??????????

---

## ??????

### ????
- `server/domain/multi_ocr_client.go`
- `Dockerfile.tesseract`
- `Dockerfile.easyocr`
- `doc/MULTI_ENGINE_OCR_PROGRESS.md` (??????)

### ??
- `server/main.go`: MultiOCRClient??????
- `Dockerfile.easyocr`: Debian??????????????
- `docker-compose.yml`: ??OCR??????
- `server/ocr/main.go`: ????????????

### ?????????
- `test_upload_backend.sh`: ?????????????????????

---

## ????

### Server
- `OCR_TESSERACT_ENDPOINT`: Tesseract OCR???????????
  - ?: `http://ocr-tesseract-service:50052`
- `OCR_EASYOCR_ENDPOINT`: EasyOCR???????????
  - ?: `http://ocr-easyocr-service:50053`
- `OCR_SERVICE_ENDPOINT`: ????????????????
  - ?: `ocr-service:50052`

### OCR Services
- `OCR_SERVICE_PORT`: OCR??????????
- `OCR_ENGINES`: ????????????????
  - ?: `tesseract` ??? `easyocr`
- `EASYOCR_ENABLED`: EasyOCR???????`true`/`false`?

---

## ??????

1. `Fix EasyOCR Dockerfile build error and update test script`
   - EasyOCR Dockerfile??????????`--break-system-packages`?

2. `Fix EasyOCR container build: Use Debian-based builder`
   - ????????Debian??????

3. `Fix EasyOCR container runtime library path`
   - ??????????????

4. `Add MultiOCRClient for managing multiple OCR endpoints`
   - MultiOCRClient??????

5. `Initialize MultiOCRClient in server/main.go`
   - server/main.go?MultiOCRClient????

---

## ????

1. **EasyOCR????????????**
   - EasyOCR?PyTorch???????????????????12GB?
   - ??????????????????

2. **?????**
   - ???????OCR?????????????
   - ??????????????????
   - ????????????????????????

3. **?????**
   - ???`OCR_SERVICE_ENDPOINT`??????
   - `OCR_TESSERACT_ENDPOINT`/`OCR_EASYOCR_ENDPOINT`???????????????

---

## ???????

?????????????????????

1. ????: ???????????OCR?????????????????????
2. ApplicationService???: MultiOCRClient?????????????
3. ??????????: ??????PaddleOCR?????

??????????????????OCR???????????????????????????????????