# ?????????

## ???

???`github.com/gen2brain/go-fitz`????????????????????:
```
go: github.com/gen2brain/go-fitz@v0.0.0-20240103120924-b81372b3a621: invalid version: unknown revision b81372b3a621
```

## ????

### 1. go-fitz????????????

????????????????????:
- **???**: `v1.24.15`
- ?????????????:
  - v1.24.14, v1.24.13, v1.24.12, v1.24.11
  - v1.23.7, v1.23.1, v1.23.0
  - v1.22.2, v1.22.1, v1.22.0
  - v1.20.2, v1.20.1, v1.20.0
  - v1.19.0, v1.18.0, v1.13.0

### 2. ????????????

#### ????
- Go 1.25.3????????????????
- `git`????????????

#### ??

1. **go.mod???**
   ```bash
   # go.mod????????
   # ???:
   github.com/gen2brain/go-fitz v0.0.0-20240103120924-b81372b3a621
   
   # ???:
   github.com/gen2brain/go-fitz v1.24.15
   ```

2. **???????**
   ```bash
   go mod tidy
   ```
   ???`go.sum`????????????

3. **???????**
   ```bash
   go mod verify
   ```

4. **???**
   ```bash
   # ????????????
   go build -o ocr-service ./server/ocr/main.go
   
   # ???Docker????????
   docker-compose build ocr-service
   ```

### 3. Docker????????

Docker???????????????`go.mod`??????:

```bash
# 1. go.mod????????1?
# 2. go mod tidy?????go.sum?????????????Docker???????

# Docker??????go mod tidy???????:
docker run --rm -v "$(pwd):/work" -w /work golang:1.25-alpine \
  sh -c "apk add --no-cache git && go mod tidy"

# 3. Docker???
docker-compose build ocr-service
```

### 4. ????????????

go-fitz?????????????PDF?????????????:

1. **go.mod??go-fitz???**
   ```bash
   # go.mod??????????????????
   ```

2. **tesseract_ocr.go???**
   ```go
   // import??go-fitz?????????????
   // import "github.com/gen2brain/go-fitz"
   
   // processPDF??????????
   func (e *tesseractEngine) processPDF(ctx context.Context, filename string, content io.Reader, result *OCRResult) (*OCRResult, error) {
       result.Status = "failed"
       result.Error = fmt.Errorf("PDF processing is temporarily disabled")
       return result, result.Error
   }
   ```

3. **???????**
   ```bash
   go mod tidy
   ```

## ???????

**??**: go-fitz?????v1.24.15????????

1. `go.mod`???:
   ```go
   github.com/gen2brain/go-fitz v1.24.15
   ```

2. ?????`go mod tidy`????Go???????????????
   ```bash
   go mod tidy
   ```

3. ????Docker?????????Go????????????????:
   ```bash
   docker run --rm -v "$(pwd):/work" -w /work golang:1.25-alpine \
     sh -c "apk add --no-cache git && go mod tidy"
   ```

4. ???????:
   ```bash
   git add go.mod go.sum
   git commit -m "fix: Update go-fitz to v1.24.15"
   ```

5. Docker???:
   ```bash
   docker-compose build ocr-service
   ```

## ????

????????????????:

```bash
# ?????????????
go list -m -versions github.com/gen2brain/go-fitz

# ???????????
go list -m github.com/gen2brain/go-fitz

# ???????????
go mod graph | grep go-fitz
```

## ?????2024??

### go-fitz?????
- ? `go.mod`?`v1.24.15`?????
- ? `go mod tidy`?????????
- ? Dockerfile?`leptonica-dev`?`tesseract-ocr-dev`?????

### ?????go mod tidy???????

**??1: Go???????????????????**
```bash
cd /home/b0949/develop/grpc-sample-minimal
go mod tidy
```

**??2: Go????????????????Docker????**
```bash
cd /home/b0949/develop/grpc-sample-minimal
docker run --rm -v "$(pwd):/work" -w /work golang:1.25-alpine \
  sh -c "apk add --no-cache git && go mod tidy"
```

???`go.sum`??????????????????

## ????????????

### leptonica?????????
gosseract?CGO?????????????`leptonica-dev`???????????
Dockerfile???????????
- `tesseract-ocr-dev`
- `leptonica-dev`