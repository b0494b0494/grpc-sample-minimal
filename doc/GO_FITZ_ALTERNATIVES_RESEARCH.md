# go-fitz?????????

## ???
go-fitz?Alpine Linux?musl libc????????????????
```
undefined reference to `__printf_chk'
undefined reference to `__snprintf_chk'
```

???go-fitz?glibc??????????????????????????

## ???????

### 1. poppler-utils????

#### ??
- PDF??????????????????
- Alpine Linux??????????
- `pdftoppm`?????PDF?PNG/JPEG?????

#### ????
```go
// processPDF??
cmd := exec.Command("pdftoppm", "-png", "-r", "150", tempFile.Name(), "page")
// ??????????
// ????????ProcessImage???
```

#### ????????
```dockerfile
RUN apk add --no-cache poppler-utils
```

#### ????
- Alpine Linux???????
- ??
- ??????

#### ?????
- ?????????????exec.Command?
- ????????????

---

### 2. ImageMagick

#### ??
- ????????PDF???????
- Alpine Linux??????????

#### ????
```go
cmd := exec.Command("convert", "-density", "150", tempFile.Name()+"[0]", "page.png")
```

#### ????????
```dockerfile
RUN apk add --no-cache imagemagick
```

#### ????
- ???
- Alpine Linux???????

#### ?????
- ????
- ????????????

---

### 3. gcompat?glibc???????

#### ??
- musl libc?glibc?????
- go-fitz?????????????

#### ????
```dockerfile
RUN apk add --no-cache gcompat
```

#### ????
- go-fitz??????????????

#### ?????
- ????????????
- ????glibc??????????????

---

### 4. Pure Go????????

#### A. unidoc/unipdf
- **??**: Pure Go???CGO???
- **?????**: ????????????????
- **??**: PDF?????????????????

#### B. pdfcpu
- **??**: Pure Go???CGO???
- **?????**: Apache 2.0
- **??**: PDF???????????????

#### ?????????
- PDF?????????????????????
- OCR????????

---

## ?????poppler-utils???

### ??

1. **Dockerfile?poppler-utils???**
```dockerfile
RUN apk add --no-cache \
    tesseract-ocr \
    poppler-utils  # ??
```

2. **processPDF?????**
```go
import (
    "os/exec"
    "path/filepath"
    // ...
)

func (e *tesseractEngine) processPDF(ctx context.Context, filename string, content io.Reader, result *OCRResult) (*OCRResult, error) {
    // PDF??????????
    tempFile, err := savePDFToTempFile(content)
    // ...
    
    // pdftoppm?PDF??????
    outputDir := filepath.Dir(tempFile.Name())
    cmd := exec.CommandContext(ctx, "pdftoppm", "-png", "-r", "150", tempFile.Name(), 
        filepath.Join(outputDir, "page"))
    if err := cmd.Run(); err != nil {
        return nil, fmt.Errorf("failed to convert PDF to images: %w", err)
    }
    
    // ??????????????
    // page-01.png, page-02.png, ...
    // ????ProcessImage???
    // ...
}
```

## ??????

1. poppler-utils????????????
2. processPDF???poppler-utils??????
3. ????PDF?????OCR???