# ??????????????

## ??

**???????????????????????????????**

???????????
1. Docker Compose???
2. ?????????
3. OCR?????????????
4. ??????????????LLM?????

## ????

### Phase 1: SQLite FTS?????????

**??**: ???SQLite?????????????????????

**????**:
- `ocr_results`?????FTS5?????????
- ????API??????????
- Web UI????????

**????**:
- ??????
- ????
- ??????

---

### Phase 2: Meilisearch

**??**: ???????????

**????**:
- Docker Compose?Meilisearch???
- OCR???Meilisearch????????
- ????API??????????
- ??????????

**????**:
- ??????????
- ?????SQLite FTS????
- ??????????
- ??????

---

### Phase 3: Qdrant

**??**: LLM???????????????

**????**:
- Docker Compose?Qdrant???
- ???????????????Python/Docker?
- OCR??????????Qdrant???
- ??????API??????????
- ?????????????

**????**:
- ?????????
- LLM???????
- ?????????
- ?????????????????

---

### Phase 4: Elasticsearch

**??**: ???????????????

**????**:
- Docker Compose?Elasticsearch???
- OCR???Elasticsearch????????
- ????????????fuzzy, phrase, range??
- Kibana????????????

**????**:
- ??????
- ??????
- ????????????
- ??????

---

### Phase 5: PostgreSQL + pgvector

**??**: ??????????????????

**????**:
- Docker Compose?PostgreSQL + pgvector???
- OCR???PostgreSQL????FTS + pgvector?
- ????????API?????? + ?????
- ??????????

**????**:
- ???????????
- ??????????????
- ??????
- ???

---

### Phase 6: Typesense???????

**??**: Meilisearch??????????????????

**????**:
- Docker Compose?Typesense???
- OCR???Typesense????????
- ??API???

**????**:
- Meilisearch????
- ?????
- ???????

---

## ????

### ????????

```
server/
??? domain/
?   ??? search/
?   ?   ??? interface.go           # ??????????????
?   ?   ??? sqlite_search.go       # SQLite FTS??
?   ?   ??? meilisearch.go         # Meilisearch??
?   ?   ??? qdrant_search.go       # Qdrant??
?   ?   ??? elasticsearch.go       # Elasticsearch??
?   ?   ??? postgres_search.go     # PostgreSQL+pgvector??
?   ??? ...
??? embedding/
?   ??? service.go                 # ????????????Qdrant??
??? ...
```

### ??????????????

```go
// server/domain/search/interface.go
package search

import (
    "context"
    "grpc-sample-minimal/server/domain"
)

type SearchService interface {
    // IndexOCRResult OCR????????????
    IndexOCRResult(ctx context.Context, result *domain.OCRResult) error
    
    // Search ????
    Search(ctx context.Context, query string, limit int) ([]*SearchResult, error)
    
    // VectorSearch ??????????????
    VectorSearch(ctx context.Context, query string, limit int) ([]*SearchResult, error)
    
    // HybridSearch ??????????? + ?????
    HybridSearch(ctx context.Context, query string, limit int) ([]*SearchResult, error)
}

type SearchResult struct {
    Filename      string
    ExtractedText string
    Score         float64
    EngineName    string
}
```

### gRPC/HTTP API

```go
// proto/greeter.proto ???
rpc SearchOCRResults (SearchRequest) returns (SearchResponse) {}
rpc VectorSearchOCRResults (VectorSearchRequest) returns (SearchResponse) {}

// webapp/handlers/search_ocr.go
func SearchOCRHandler(w http.ResponseWriter, r *http.Request)
func VectorSearchOCRHandler(w http.ResponseWriter, r *http.Request)
```

---

## ????

### 1. ???????1-5??

- **5?**: ???????????
- **4?**: ????????
- **3?**: ?????????
- **2?**: ????????
- **1?**: ???????????

### 2. ?????1-5??

1000??OCR????????????????????

- **5?**: < 10ms
- **4?**: 10-50ms
- **3?**: 50-200ms
- **2?**: 200-500ms
- **1?**: > 500ms

### 3. ?????1-5??

??????????????????

- **5?**: ????
- **4?**: ?????
- **3?**: ??
- **2?**: ????
- **1?**: ???

### 4. LLM???1-5??

???????????????

- **5?**: ????????????????
- **4?**: ????????????????
- **3?**: ?????????????????
- **2?**: ?????????
- **1?**: ????????

### 5. Go???1-5??

Go????????????

- **5?**: ?????Go?????
- **4?**: ?????Go??????
- **3?**: REST API??????????
- **2?**: REST API???????
- **1?**: ?????

### 6. ???????1-5??

????CPU???

- **5?**: ??????< 100MB RAM?
- **4?**: ???100-500MB RAM?
- **3?**: ????500MB-1GB RAM?
- **2?**: ?????1-2GB RAM?
- **1?**: ??????> 2GB RAM?

### 7. ??????????????1-5??

- **5?**: ???????????????????
- **4?**: ?????????
- **3?**: ??????????
- **2?**: ?????????
- **1?**: ?????????????

---

## ????????

| ????? | ????? | ???? | ???? | LLM?? | Go?? | ???? | ?????? | ?? |
|------------|-----------|---------|---------|---------|--------|----------|-------------|------|
| SQLite FTS | | | | | | | | |
| Meilisearch | | | | | | | | |
| Qdrant | | | | | | | | |
| Elasticsearch | | | | | | | | |
| PostgreSQL+pgvector | | | | | | | | |
| Typesense | | | | | | | | |

---

## ??????

### OCR?????????????????

1. ??????????????????
2. ??????PDF??????
3. ???????????
4. ??????OCR??
5. ???????

### ???????

- ????: "???"
- ??????: "2024?11?"
- ?????: "???????" ? "???"
- ????: "???????????"
- ??: "receipt"
- ??: "invoice from November"

---

## ????????

### SQLite FTS
- [ ] FTS5???????
- [ ] OCR??????????
- [ ] ??API???
- [ ] Web UI???
- [ ] ?????

### Meilisearch
- [ ] Docker Compose??
- [ ] Meilisearch?????????
- [ ] OCR??????????
- [ ] ??API???
- [ ] ?????

### Qdrant
- [ ] Docker Compose??
- [ ] ??????????????
- [ ] Qdrant?????????
- [ ] ????????
- [ ] ??????API???
- [ ] ?????

### Elasticsearch
- [ ] Docker Compose??
- [ ] Elasticsearch?????????
- [ ] ????????
- [ ] OCR??????????
- [ ] ??API???
- [ ] ?????

### PostgreSQL + pgvector
- [ ] Docker Compose??
- [ ] pgvector??????
- [ ] ???????FTS + pgvector?
- [ ] OCR?????
- [ ] ????????API???
- [ ] ?????

---

## ???????

1. **?????**: SQLite FTS???
2. **??????**: Meilisearch?Qdrant?Docker Compose??
3. **??????**: 1????????????
4. **???????**: ??????????`doc/SEARCH_EVALUATION_RESULTS.md`???
